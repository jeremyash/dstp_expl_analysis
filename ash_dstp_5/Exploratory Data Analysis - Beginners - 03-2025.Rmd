---
title: "Exploratory Data Analysis - Beginners R"
author: "Jeremy Ash"
date: "2025-03-25"
output:
  html_document: 
    toc: TRUE
    toc_depth: 2
    toc_float: TRUE
---

```{r setup, message=FALSE, warning=FALSE, include=FALSE}
# packages
library(tidyverse)
# library(dplyr)
# library(httr)
# library(moments)
# library(scales)
# library(ggplot2)
# library(ggpp)
# library(readxl)
# library(expss)
# library(sf)
# library(httr)
# library(purrr)
# library(extrafont)
# library(patchwork)
# library(scico)
# library(psych)
```

# Part A: Load and inspect the data

This notebook analyzes USDA-ERS data on food environment factors (a subset of the Food Environment Atlas), along with county-level food security data from Feeding America, to explore drivers of child poverty rate. We use [this subset of data](https://usdagcc.sharepoint.com/:f:/r/sites/FNS-DataScienceTrainingProgram/Shared%20Documents/FY24-25%20Beginners/Assignments/Assignment%205%20-%20Exploratory%20Data%20Analysis?csf=1&web=1&e=HG79oc) to create summary statistics, scatter plots, histograms, and correlations.


## A.1: Loading the data

First, we import the csv file into a data frame object called `food_env`. 


```{r part_a_1, warning=FALSE, message = FALSE}


# read data into R
# note: the working directory here is the location of the .Rmd file, so I have put the csv file in the same location
food_env <- read_csv("EDA_assignment_dataset.csv")


```
## A.2: Summary statistics

Next, we explore the basic summary statistics for each column. A quick way to do this is to use the `summary()` function. If we wwere interested in particular summary statistics, we can also create a new dataframe with summary measures using `tidyverse` functions. 

```{r part_a_2, warning=FALSE, messages = FALSE}

# basic summary stats of variables in the food_env dataset, showing the number of NAs per variable
summary(food_env)

# custom set of summary stats for CHILDPOVRATE15
childpovrate15_summary <- food_env %>% 
  summarise(n = length(na.omit(CHILDPOVRATE15)), # number of observations with non-NA values
            n_na = length(which(is.na(CHILDPOVRATE15))), # number of NA values
            min = min(CHILDPOVRATE15, na.rm = TRUE), # min value, excluding NA
            max = max(CHILDPOVRATE15, na.rm = TRUE), # max value, excluding NA
            mean = mean(CHILDPOVRATE15, na.rm = TRUE), # mean value, excluding NA
            median = median(CHILDPOVRATE15, na.rm = TRUE), # median value, excluding NA
  )
  
childpovrate15_summary

```

## A.3: Exclude NA values

We see above that there are various amounts of `NA` values in each column. To continue with an analysis focused only on complete cases, we next create a dataset that excludes any rows with NA values.

```{r part_a_3, warning=FALSE, message = FALSE}

# create a new data set with only complete observations
food_env_full <- food_env %>% 
  drop_na() # exclude any row containing NA values

# create a variable showing the length of food_env
food_env_n <- dim(food_env)[1]
food_env_n

# create a variable showing the length of food_env_full to see how many NA cases were dropped
food_env_full_n <- dim(food_env_full)[1]
food_env_full_n
```

Above, we can see the difference in the number of rows of each dataframe is 29. In case this hasn't been shown before, you can also use inline code in Rmd files, so we could say that in the original dataset, there were `r food_env_n` observations. After excluding `NA` values, there are `r food_env_full_n` observations. 


# Part B: Explore child poverty rates

Now we want to start visualizing the data, specifically the child poverty rates from 2015. Below is a histogram showing the distribution of child poverty rates from 2015, with vertical lines indicating the mean and median values for this particular variable. We see that the median is lower than the mean, given the skewness of the data.

```{r part_b, warning=FALSE, message = FALSE}
# note: we have already calculated the mean and median values of CHILDPOVRATE15 in childpovrate15_summary, but first we will reshape that data into a simplified dataframe 

childpovrate15_lines <- childpovrate15_summary %>% 
  
  # select the two summary measures of interest
  select(mean, median) %>% 
  
  # gather into a long format
  gather(key = "stat", value = "val")
  


# using ggplot2, we can create the histogram
childpovrate15_hist <- ggplot() +
  # create histogram of values
  geom_histogram(aes(x = CHILDPOVRATE15), 
                 data = food_env_full) + 
  
  # plot mean and median values, with different linetypes
  geom_vline(aes(xintercept = val, linetype = stat), 
             key_glyph = "path", # this changes legend lines to be horizontal
             data = childpovrate15_lines) +
  
  
  # use a minimal theme 
  theme_minimal() +
  
  # add a title
  labs(title = "Distribution of Child Poverty Rates, 2015")


# display the figure
childpovrate15_hist


```



# Part C: Explore low access to stores and no vehicle access

Before we investigate correlative relationships, let's look at the distribution of one potential factor in child poverty rates: low accessibility to stores and no vehicle access. 

## C.1: Basic distribution

Below is a histogram and boxplot showing the overall distribution of the variable `PCT_LACCESS_HHNV15`. We can see in the histogram a long tail to the right, showing that a low number counties have a high percentage households with no car and low access to stores. This is confirmed looking at the boxplot, where we see a number of points falling to the right of the "upper whisker". 

```{r part_c_1, warning=FALSE, message = FALSE}

# lets create a dataframe where we can again plot the mean and median values
pct_lacess_hhnv15_lines <- food_env_full %>% 
  
  # summarise using food_env_full, so no NA values present
  summarise(mean = mean(PCT_LACCESS_HHNV15), # mean value
            median = median(PCT_LACCESS_HHNV15) # median value
  ) %>% 
  
  # gather into a long format
  gather(key = "stat", value = "val")


# using ggplot2, we can create the histogram
pct_lacess_hhnv15_hist <- ggplot() +
  # create histogram of values
  geom_histogram(aes(x = PCT_LACCESS_HHNV15), 
                 data = food_env_full) + 
  
  # plot mean and median values, with different linetypes
  geom_vline(aes(xintercept = val, linetype = stat), 
             key_glyph = "path", # this changes legend lines to be horizontal
             data = pct_lacess_hhnv15_lines) +
  
  # use a minimal theme 
  theme_minimal() +
  
  # add a title
  labs(title = "Distribution of Percentage of Households with Store and Vehicle Access")


# display the histogram
pct_lacess_hhnv15_hist


# similarly, using ggplot2, we can create the boxplot
pct_lacess_hhnv15_boxplot <- ggplot() +
  # create boxplot of values
  geom_boxplot(aes(x = PCT_LACCESS_HHNV15), 
                 data = food_env_full) + 
  
  # use a minimal theme 
  theme_minimal() +
  
  # add a title
  labs(title = "Distribution of Percentage of Households with Store and Vehicle Access")


# display the histogram
pct_lacess_hhnv15_boxplot

```


## C.2: Access by metro/non-metro status

Adding more detail to our exploratory analysis, we will now look at whether the distribution of `PCT_LACCESS_HHNV15` differs between metro and non-metro areas.  

```{r part_c_2, warning=FALSE, message = FALSE}

# using ggplot2, we can create the histogram
pct_lacess_hhnv15_hist <- ggplot() +
  # create histogram of values
  geom_histogram(aes(x = PCT_LACCESS_HHNV15), 
                 data = food_env_full) + 
  
  # plot mean and median values, with different linetypes
  geom_vline(aes(xintercept = val, linetype = stat), 
             key_glyph = "path", # this changes legend lines to be horizontal
             data = pct_lacess_hhnv15_lines) +
  
  # use a minimal theme 
  theme_minimal() +
  
  # add a title
  labs(title = "Distribution of Percentage of Households with Store and Vehicle Access")


# display the histogram
pct_lacess_hhnv15_hist


# similarly, using ggplot2, we can create the boxplot
pct_lacess_hhnv15_boxplot <- ggplot() +
  # create boxplot of values
  geom_boxplot(aes(x = PCT_LACCESS_HHNV15), 
                 data = food_env_full) + 
  
  # use a minimal theme 
  theme_minimal() +
  
  # add a title
  labs(title = "Distribution of Percentage of Households with Store and Vehicle Access")


# display the histogram
pct_lacess_hhnv15_boxplot

```























